---
title: "Fernanda Herbst"
format: html
editor: visual
html:
self-contained: true
toc: true
theme: cosmo
---

## TAXA B√ÅSICA FINANCEIRA

A vari√°vel 253 - Taxa B√°sica Financeira (TBF) √© uma taxa de juros de refer√™ncia que o Banco Central do Brasil divulga diariamente. Ela √© determinada atrav√©s do c√°lculo da m√©dia ponderada das taxas de juros dos t√≠tulos p√∫blicos federais prefixados (especialmente LTN) que s√£o negociados no mercado secund√°rio.\
\
A Taxa B√°sica Financeira (TBF) foi estabelecida em 1995 e serve principalmente como refer√™ncia para a Taxa Referencial (TR), que afeta a remunera√ß√£o de produtos financeiros como a poupan√ßa, empr√©stimos para moradia e certos tipos de investimentos. Apesar de ter perdido relev√¢ncia em rela√ß√£o √† taxa Selic ao longo do tempo, a TBF continua sendo um indicador importante no cen√°rio das finan√ßas p√∫blicas e contratos financeiros no Brasil.

## GR√ÅFICO

O gr√°fico mostra a progress√£o da Taxa B√°sica Financeira (TBF) m√©dia anual no Brasil ao longo do tempo, ressaltando seus principais eventos hist√≥ricos e tend√™ncias de mercado.

O gr√°fico real√ßa em vermelho o ano em que a TBF alcan√ßou seu valor mais alto na hist√≥ria. Este pico, comum em momentos de infla√ß√£o elevada ou instabilidade econ√¥mica, evidencia o esfor√ßo do Banco Central para controlar press√µes inflacion√°rias atrav√©s do aumento das taxas de juros. Este fen√¥meno pode estar ligado a crises cambiais, fuga de capitais ou desvaloriza√ß√£o repentina da moeda, como aconteceu durante transi√ß√µes de governo ou altera√ß√µes no sistema monet√°rio.Por outro lado, o √≠cone verde simboliza o valor m√≠nimo da s√©rie, comumente ligado a um cen√°rio de maior estabilidade econ√¥mica, controle da infla√ß√£o ou estrat√©gias de est√≠mulo ao crescimento atrav√©s da diminui√ß√£o das taxas de juros. Isso costuma acontecer em momentos de confian√ßa no cen√°rio macroecon√¥mico e estabilidade fiscal.

O gr√°fico tamb√©m destaca com pontos azuis tr√™s anos significativos:

1999: Mudan√ßa para a pol√≠tica monet√°ria de c√¢mbio flutuante, inaugurando uma nova fase na pol√≠tica monet√°ria do Brasil.

2008: Impactos da crise financeira mundial, que provocaram grande instabilidade nos mercados globais e impactaram na gest√£o das taxas de juros no Brasil.

2015: Ano de retra√ß√£o econ√¥mica, marcado por alta infla√ß√£o e deteriora√ß√£o da credibilidade fiscal, demandando uma a√ß√£o contundente da pol√≠tica monet√°ria.

Ao longo das √∫ltimas d√©cadas, nota-se uma tend√™ncia de redu√ß√£o da TBF, que √© coerente com o amadurecimento do sistema de metas de infla√ß√£o e o fortalecimento das institui√ß√µes fiscais e monet√°rias. No entanto, o gr√°fico mostra que elementos externos e internos, tais como crises pol√≠ticas, impactos internacionais ou mudan√ßas na situa√ß√£o fiscal, continuam a ter um impacto significativo nos juros praticados no pa√≠s.

```{r}
#| label: grafico
#| warning: false
#| echo: false

library(GetBCBData)
library(dplyr)
library(lubridate)
library(plotly)
library(purrr)

TBF.id <- 253

DadosTBF <- gbcbd_get_series(
  id = TBF.id,
  first.date = "1995-07-01",
  last.date = Sys.Date(),
  format.data = "long"
)

DadosTBF_resumo <- DadosTBF %>%
  mutate(ano = year(ref.date)) %>%
  group_by(ano) %>%
  summarise(taxa_media = mean(value, na.rm = TRUE), .groups = "drop")

ponto_max <- DadosTBF_resumo %>% filter(taxa_media == max(taxa_media, na.rm = TRUE))
ponto_min <- DadosTBF_resumo %>% filter(taxa_media == min(taxa_media, na.rm = TRUE))

# Anota√ß√µes din√¢micas com y baseado nos dados
anotacoes <- DadosTBF_resumo %>%
  filter(ano %in% c(1999, 2008, 2015)) %>%
  mutate(
    texto = c(
      "üîµ Metas de Infla√ß√£o (1999)",
      "üîµ Crise Financeira Global (2008)",
      "üîµ Recess√£o Brasileira (2015)"
    )
  )

xshifts <- c(-30, 60, 170)  # deslocamento horizontal para evitar sobreposi√ß√£o

lista_anotacoes <- map2(anotacoes$ano, seq_along(anotacoes$ano), function(x, i) {
  list(
    x = x,
    y = 1.1,  # Posi√ß√£o vertical acima do gr√°fico (mas abaixo do t√≠tulo)
    xref = "x",
    yref = "paper",
    text = anotacoes$texto[i],
    showarrow = FALSE,
    arrowhead = 4,
    ax = 0,
    ay = -30,  # seta aponta para baixo
    xshift = xshifts[i],
    font = list(color = "black", size = 12),
    align = "center",
    yanchor = "bottom"
  )
})

  #Criar dados dos pontos azuis
pontos_destaque <- DadosTBF_resumo %>% 
  filter(ano %in% c(1999, 2008, 2015))


# Gr√°fico com anima√ß√£o
grafico <- plot_ly(
  data = DadosTBF_resumo,
  x = ~ano,
  y = ~taxa_media,
  type = "scatter",
  mode = "lines+markers",
  frame = ~ano,
  line = list(color = "#1f77b4", width = 3),
  marker = list(color = "#FF7F0E", size = 8),
  name = "üìä TBF M√©dia Anual",
  text = ~paste0("Ano: ", ano, "<br>Taxa M√©dia: ", round(taxa_media, 2), "%"),
  hoverinfo = "text"
) %>%
  add_trace(
    data = ponto_max,
    x = ~ano,
    y = ~taxa_media,
    type = "scatter",
    mode = "markers+text",
    marker = list(color = "red", size = 12),
    text = ~paste0("üìà M√°ximo: ", round(taxa_media, 2), "%"),
    textposition = "top right",
    name = "üìà M√°ximo Hist√≥rico",
    showlegend = TRUE,
    inherit = FALSE
  ) %>%
  add_trace(
    data = ponto_min,
    x = ~ano,
    y = ~taxa_media,
    type = "scatter",
    mode = "markers+text",
    marker = list(color = "green", size = 12),
    text = ~paste0("üìâ M√≠nimo: ", round(taxa_media, 2), "%"),
    textposition = "bottom right",
    name = "üìâ M√≠nimo Hist√≥rico",
    showlegend = TRUE,
    inherit = FALSE
  ) %>%
  add_trace(
    data = pontos_destaque,
    x = ~ano,
    y = ~taxa_media,
    type = "scatter",
    mode = "markers",
    marker = list(color = "blue", size = 10),
    name = "Eventos Econ√¥micos",
    showlegend = TRUE,
    inherit = FALSE
  )%>%
  layout(
    title = list(
      text = "<b>TBF M√©dia Anual no Brasil<br>(Anima√ß√£o com Destaques e Eventos)</b>",
      y = 0.95
    ),
    xaxis = list(title = "Ano", dtick = 1),
    yaxis = list(title = "Taxa M√©dia (%)", range = c(0, max(DadosTBF_resumo$taxa_media) + 2)),
    plot_bgcolor = "#f9f9f9",
    paper_bgcolor = "#f9f9f9",
    margin = list(l = 50, r = 50, b = 80, t = 120),
    annotations = lista_anotacoes
  ) %>%
  animation_opts(frame = 700, transition = 300, redraw = TRUE) %>%
  animation_slider(visible = FALSE) %>%
  animation_button(x = 0, xanchor = "left", y = 0, yanchor = "bottom") %>%
  plotly::config(displayModeBar = TRUE)

grafico
```
